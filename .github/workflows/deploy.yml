name: Deploy and Start PM2

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Wait for Hostinger deployment
        run: sleep 60
        
      - name: Start application via SSH
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: 46.17.175.251
          username: u211042360
          password: ${{ secrets.SSH_PASSWORD }}
          port: 65002
          script: |
            export PATH=/opt/alt/alt-nodejs20/root/usr/bin:$PATH
            cd domains/mgvacanze.com/public_html
            npm install
            npx pm2 delete mgvacanze 2>/dev/null || true
            npx pm2 start npm --name "mgvacanze" -- start
            npx pm2 save
