/*! For license information please see cart.js.LICENSE.txt */(()=>{var n={5338:(e,t,n)=>{"use strict";var s=n(5795);t.H=s.createRoot,s.hydrateRoot},1020:(e,t,n)=>{"use strict";var s=n(1609),o=Symbol.for("react.element"),i=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),a=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,n){var s,c={},l=null,d=null;for(s in 0[0]!==n&&(l=""+n),0[0]!==t.key&&(l=""+t.key),0[0]!==t.ref&&(d=t.ref),t)i.call(t,s)&&!r.hasOwnProperty(s)&&(c[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)0[0]===c[s]&&(c[s]=t[s]);return{$$typeof:o,type:e,key:l,ref:d,props:c,_owner:a.current}}},4848:(e,t,n)=>{"use strict";e.exports=n(1020)},1609:e=>{"use strict";e.exports=window.React},5795:e=>{"use strict";e.exports=window.ReactDOM}},t={};function e(s){var o,i=t[s];return 0[0]!==i?i.exports:(o=t[s]={exports:{}},n[s](o,o.exports,e),o.exports)}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch{if("object"==typeof window)return window}}(),(()=>{e.g.importScripts&&(t=e.g.location+"");var t,s,o,n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)&&(s=n.getElementsByTagName("script"),s.length))for(o=s.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=s[o--].src;if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^/]+$/,"/"),e.p=t})(),e.p=window.wcpayAssets.url,(()=>{"use strict";window.wp.domReady;const t=e=>"undefined"!=typeof wcpayConfig?wcpayConfig[e]:p(e),p=e=>{let t=null;if("undefined"!=typeof wcpay_upe_config)t=wcpay_upe_config;else{if("object"!=typeof wc||0[0]===wc.wcSettings)return null;t=wc.wcSettings.getSetting("woocommerce_payments_data")||{}}return t[e]||null},n=e=>"object"==typeof wcpayExpressCheckoutParams&&wcpayExpressCheckoutParams.hasOwnProperty(e)?wcpayExpressCheckoutParams[e]:null,u=(e,t,n="wcpay_")=>e.toString().replace("%%endpoint%%",n+t),y=()=>{return o=0[0],i=0[0],e=function*(){var e,s,o;let a=(()=>{const e=document.cookie.split(";");for(let n=0;n<e.length;n++){let t=e[n];for(;" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf("tk_ai="))return t.substring(6,t.length)}})();if(a){const e={_ut:"anon",_ui:a};return JSON.stringify(e)}const r=null!==(e=t("platformTrackerNonce"))&&0[0]!==e?e:null===(s=n("nonce"))||0[0]===s?0[0]:s.platform_tracker,c=null!==(o=t("ajaxUrl"))&&0[0]!==o?o:n("ajax_url"),i=new FormData;i.append("tracksNonce",r),i.append("action","get_identity");try{const t=yield fetch(c,{method:"post",body:i});if(!t.ok)return;const e=yield t.json();return e.success&&e.data&&e.data._ui&&e.data._ut?JSON.stringify(e.data):0[0]}catch{return}},new((s=0[0])||(s=Promise))(function(t,n){function r(t){try{a(e.next(t))}catch(e){n(e)}}function c(t){try{a(e.throw(t))}catch(e){n(e)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s(function(e){e(n)})).then(r,c)}a((e=e.apply(o,i||[])).next())});var e,s,o,i};function a(e,t="",n){for(const o in e){const s=e[o],i=t?t+"["+o+"]":o;"string"==typeof s||"number"==typeof s?n.append(i,s):"object"==typeof s&&a(s,i,n)}return n}async function m(e,t,n){const s=a(t,"",new FormData),o=await fetch(e,{method:"POST",body:s,...n});return await o.json()}var o,r,s=e(1609);const b=window.wp.i18n;function d(e){window.WooPayConnect||(window.WooPayConnect={}),window.WooPayConnect.iframeInjectedState=e}function i(){return window?.WooPayConnect?.postMessageTimeout||5e3}o=e(4848);const f=()=>{const e=(0,s.useRef)(),[n,i]=(0,s.useState)("");return(0,s.useEffect)(()=>{(async()=>{const s=t("testMode"),o=t("woopayHost"),a=t("woopayMerchantId"),e=new URLSearchParams({testMode:s,source_url:window.location.href,blogId:a}),n=await y();n&&e.append("tracksUserIdentity",n),i(`${o}/connect/?${e.toString()}`)})()},[]),(0,s.useEffect)(()=>{if(!e.current)return;const n=e.current;n.addEventListener("load",()=>{d(2),window.dispatchEvent(new MessageEvent("message",{source:window,origin:t("woopayHost"),data:{action:"get_iframe_post_message_success",value:e=>n.contentWindow.postMessage(e,t("woopayHost"))}}))})},[n]),(0,o.jsx)("iframe",{ref:e,id:"woopay-connect-iframe",src:n,style:{height:0,width:0,border:"none",margin:0,padding:0,overflow:"hidden",display:"block",visibility:"hidden",position:"fixed",pointerEvents:"none",userSelect:"none"},title:(0,b.__)("WooPay Connect Direct Checkout","woocommerce-payments")})};r=e(5338);const h=class{iframePostMessage=null;listeners={};constructor(){this.listeners={getIframePostMessageCallback:()=>{},getPostMessageTimeoutCallback:()=>{}},this.removeMessageListener=this.attachMessageListener(),this.injectWooPayConnectIframe()}attachMessageListener(){const e=e=>{t("woopayHost").startsWith(e.origin)&&this.callbackFn(e.data)};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}detachMessageListener(){"function"==typeof this.removeMessageListener&&this.removeMessageListener()}injectWooPayConnectIframe(){const n=window?.WooPayConnect?.iframeInjectedState||0;if(2===n){const e=document.querySelector("#woopay-connect-iframe");return 0[0]}if(1===n)return void(this.iframePostMessage=new Promise(e=>{this.listeners.getIframePostMessageCallback=e}));d(1);const e=document.createElement("div");e.style.visibility="hidden",e.style.position="fixed",e.style.height="0",e.style.width="0",e.style.bottom="0",e.style.right="0",e.id="woopay-connect-iframe-container",document.body.appendChild(e);const s=this;this.iframePostMessage=new Promise(e=>{s.listeners.getIframePostMessageCallback=e}),(0,r.H)(e).render((0,o.jsx)(f,{}))}injectTemporaryWooPayConnectIframe(){let n;const s=new Promise(e=>{n=e}),e=document.createElement("iframe");return e.id="temp-woopay-connect-iframe",e.src=t("woopayHost")+"/connect/",e.height=0,e.width=0,e.border="none",e.margin=0,e.padding=0,e.overflow="hidden",e.display="block",e.visibility="hidden",e.position="fixed",e.pointerEvents="none",e.userSelect="none",e.addEventListener("load",()=>{n(n=>e.contentWindow.postMessage(n,t("woopayHost")))}),document.body.appendChild(e),{resolvePostMessagePromise:s,removeTemporaryIframe:()=>{document.body.removeChild(e)}}}async sendMessageAndListenWith(e,t){const n=new Promise((e,n)=>{let s=!1;const o=setTimeout(()=>{s=!0,n(new Error("WooPayConnectIframe did not respond within the allotted time."))},i());this.listeners[t]=t=>{s||(o&&clearTimeout(o),e(t))}});if("function"!=typeof this.iframePostMessage?.then)throw new Error("iframePostMessage is not set");return(await this.iframePostMessage)(e),await n}async getPostMessageTimeout(){try{return await this.sendMessageAndListenWith({action:"getPostMessageTimeout"},"getPostMessageTimeoutCallback")}catch{return null}}callbackFn(e){switch(e.action){case"get_iframe_post_message_success":this.listeners.getIframePostMessageCallback(e.value);break;case"get_post_message_timeout_success":this.listeners.getPostMessageTimeoutCallback(e.value)}}},g=class extends h{constructor(){super(),this.listeners={...this.listeners,getIsUserLoggedInCallback:()=>{},getEncryptedDataCallback:()=>{}}}async isUserLoggedIn(){try{return await this.sendMessageAndListenWith({action:"getIsUserLoggedIn"},"getIsUserLoggedInCallback")}catch{return!1}}async getEncryptedData(){try{return await this.sendMessageAndListenWith({action:"getEncryptedData"},"getEncryptedDataCallback")}catch{return null}}callbackFn(e){switch(super.callbackFn(e),e.action){case"get_is_user_logged_in_success":this.listeners.getIsUserLoggedInCallback(e.value);break;case"get_encrypted_data_success":this.listeners.getEncryptedDataCallback(e.value)}}},v=class extends h{constructor(){super(),this.listeners={...this.listeners,setRedirectSessionDataCallback:()=>{},setTempThirdPartyCookieCallback:()=>{},getIsWooPayReachableCallback:()=>{},getIsThirdPartyCookiesEnabledCallback:()=>{},setPreemptiveSessionDataCallback:()=>{}}}async isWooPayThirdPartyCookiesEnabled(){const{resolvePostMessagePromise:t,removeTemporaryIframe:e}=this.injectTemporaryWooPayConnectIframe(),s=new Promise((e,t)=>{let n=!1;const s=setTimeout(()=>{n=!0,t(new Error("WooPayConnectIframe did not respond within the allotted time."))},i());this.listeners.setTempThirdPartyCookieCallback=t=>{n||(s&&clearTimeout(s),e(t))}});if("function"!=typeof t?.then)return!1;const n=await t;n({action:"setTempThirdPartyCookie"});try{if(!await s)return e(),!1}catch{return e(),!1}const o=new Promise((e,t)=>{let n=!1;const s=setTimeout(()=>{n=!0,t(new Error("WooPayConnectIframe did not respond within the allotted time."))},i());this.listeners.getIsThirdPartyCookiesEnabledCallback=t=>{n||(s&&clearTimeout(s),e(t))}});n({action:"getIsThirdPartyCookiesEnabled"});try{return await o}catch{return!1}finally{e()}}async sendRedirectSessionDataToWooPay(e){try{return await super.sendMessageAndListenWith({action:"setRedirectSessionData",value:e},"setRedirectSessionDataCallback")}catch{return null}}async setPreemptiveSessionData(e){try{return await super.sendMessageAndListenWith({action:"setPreemptiveSessionData",value:e},"setPreemptiveSessionDataCallback")}catch{return null}}async isWooPayReachable(){try{return await this.sendMessageAndListenWith({action:"isWooPayReachable"},"getIsWooPayReachableCallback")}catch{return!1}}callbackFn(e){switch(super.callbackFn(e),e.action){case"set_redirect_session_data_success":this.listeners.setRedirectSessionDataCallback(e.value);break;case"set_redirect_session_data_error":this.listeners.setRedirectSessionDataCallback({is_error:!0});break;case"set_temp_third_party_cookie_success":this.listeners.setTempThirdPartyCookieCallback(e.value);break;case"get_is_third_party_cookies_enabled_success":this.listeners.getIsThirdPartyCookiesEnabledCallback(e.value);break;case"get_is_woopay_reachable_success":this.listeners.getIsWooPayReachableCallback(e.value);break;case"set_preemptive_session_data_success":this.listeners.setPreemptiveSessionDataCallback(e.value);break;case"set_preemptive_session_data_error":this.listeners.setPreemptiveSessionDataCallback({is_error:!0})}}},l=class{static userConnect;static sessionConnect;static encryptedSessionDataPromise;static redirectElements={CLASSIC_CART_PROCEED_BUTTON:".wc-proceed-to-checkout .checkout-button",BLOCKS_CART_PROCEED_BUTTON:".wp-block-woocommerce-proceed-to-checkout-block",BLOCKS_MINI_CART_PROCEED_BUTTON:"a.wp-block-woocommerce-mini-cart-checkout-button-block",BLOCKS_FOOTER_MINI_CART_PROCEED_BUTTON:"a.wc-block-mini-cart__footer-checkout",CLASSIC_MINI_CART_PROCEED_BUTTON:".widget_shopping_cart a.button.checkout"};static init(){this.getSessionConnect()}static getUserConnect(){return this.userConnect||(this.userConnect=new g),this.userConnect}static getSessionConnect(){return this.sessionConnect||(this.sessionConnect=new v),this.sessionConnect}static teardown(){this.sessionConnect?.detachMessageListener(),this.userConnect?.detachMessageListener(),this.sessionConnect=null,this.userConnect=null}static isWooPayDirectCheckoutEnabled(){return t("isWooPayDirectCheckoutEnabled")}static async isWooPayReachable(){return this.getSessionConnect().isWooPayReachable()}static async isUserLoggedIn(){return this.getUserConnect().isUserLoggedIn()}static async getEncryptedData(){return this.getUserConnect().getEncryptedData()}static async isWooPayThirdPartyCookiesEnabled(){return this.getSessionConnect().isWooPayThirdPartyCookiesEnabled()}static async initPostMessageTimeout(){const e=await this.getSessionConnect().getPostMessageTimeout();var t;e&&(t=e,window.WooPayConnect||(window.WooPayConnect={}),window.WooPayConnect.postMessageTimeout=t)}static async getWooPayCheckoutUrl(){try{let e;if(e=this.isEncryptedSessionDataPrefetched()?await this.encryptedSessionDataPromise:await this.getEncryptedSessionData(),!this.isValidEncryptedSessionData(e))throw new Error("Could not retrieve encrypted session data from store.");const t=await this.getSessionConnect().sendRedirectSessionDataToWooPay(e);if(!t?.redirect_url)throw new Error("Could not retrieve WooPay checkout URL.");const{redirect_url:n}=t;if(!this.validateRedirectUrl(n,"platform_checkout_key"))throw new Error("Invalid WooPay session URL: "+n);return t.redirect_url}catch(e){throw new Error(e.message)}}static isValidEncryptedSessionData(e){return e&&e?.blog_id&&e?.data?.session&&e?.data?.iv&&e?.data?.hash}static async getWooPayMinimumSessionUrl(){const e=await this.getWooPayMinimumSesssionDataFromMerchant();if(!1===e?.success)throw new Error("Could not retrieve redirect data from merchant.");if(!this.isValidEncryptedSessionData(e))throw new Error("Invalid encrypted session data.");const{blog_id:n,data:{session:s,iv:o,hash:i}}=e,a=new URLSearchParams({checkout_redirect:1,blog_id:n,session:s,iv:o,hash:i});return t("woopayHost")+"/woopay/?"+a.toString()}static getCheckoutButtonElements(){const t=[],e=e=>{const n=document.querySelector(e);n&&t.push(n)};return e(this.redirectElements.CLASSIC_CART_PROCEED_BUTTON),e(this.redirectElements.BLOCKS_CART_PROCEED_BUTTON),e(this.redirectElements.CLASSIC_MINI_CART_PROCEED_BUTTON),t}static getClassicProceedToCheckoutButton(){return document.querySelector(this.redirectElements.CLASSIC_CART_PROCEED_BUTTON)}static getMiniCartProceedToCheckoutButton(){return document.querySelector(this.redirectElements.BLOCKS_MINI_CART_PROCEED_BUTTON)}static getFooterMiniCartProceedToCheckoutButton(){return document.querySelector(this.redirectElements.BLOCKS_FOOTER_MINI_CART_PROCEED_BUTTON)}static addRedirectToWooPayEventListener(e,t=!1){e.forEach(e=>{const n={is_loading:!1};e.addEventListener("click",async s=>{if(n.is_loading)return void s.preventDefault();let o;if(n.is_loading=!0,(e=>{if(e.classList.contains("wp-block-woocommerce-mini-cart-checkout-button-block")||e.classList.contains("wc-block-mini-cart__footer-checkout"))return!0;const t=e.classList.contains("checkout-button"),n=e.parentElement?.classList?.contains("wc-proceed-to-checkout");return t&&n})(e)&&(e=>{const n=window.getComputedStyle(e,null).getPropertyValue("color"),t=document.createElement("span");t.classList.add("wc-block-components-spinner"),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.color=n,t.style.fontSize="unset",t.style.display="inline",t.style.lineHeight="0",t.style.margin="0",t.style.border="0",t.style.padding="0",e.style.color="rgba( 0, 0, 0, 0 )",e.style.position="relative",e.appendChild(t)})(e),o="a"===e.tagName.toLowerCase()?e.href:e.querySelector("a")?.href,o){s.preventDefault();try{let e="";if(t)e=await this.getWooPayCheckoutUrl();else{if(!await this.isWooPayReachable())throw new Error("WooPay is currently not available.");e=await this.getWooPayMinimumSessionUrl()}this.teardown(),window.location.href=e}catch(e){console.warn(e),this.teardown(),window.location.href=o}}else this.teardown()})})}static async getEncryptedSessionData(){const e=await this.getEncryptedData();return m(u(t("wcAjaxUrl"),"get_woopay_session"),{_ajax_nonce:t("woopaySessionNonce"),...e&&{encrypted_data:e}})}static async getWooPayMinimumSesssionDataFromMerchant(){return t("woopayMinimumSessionData")?t("woopayMinimumSessionData"):m(u(t("wcAjaxUrl"),"get_woopay_minimum_session_data"),{_ajax_nonce:t("woopaySessionNonce")})}static validateRedirectUrl(e,n){try{const s=new URL(e);return s.origin===t("woopayHost")&&!!s.searchParams.has(n)}catch{return!1}}static maybePrefetchEncryptedSessionData(){const e=window?.wcpayWooPayDirectCheckout?.params?.is_product_page;0[0]===e||e||(this.encryptedSessionDataPromise=new Promise(e=>{e(this.getEncryptedSessionData())}))}static setEncryptedSessionDataAsNotPrefetched(){this.encryptedSessionDataPromise=null}static isEncryptedSessionDataPrefetched(){return"function"==typeof this.encryptedSessionDataPromise?.then}},j=()=>{const e=document.cookie.split(";").find(e=>e.includes("skip_woopay"));if(!e)return!1;const t=e?.split("=");return"skip_woopay"===t[0].trim()&&"1"===t[1].trim()},c=()=>{((e,s={})=>{var i,a,r,c;if(!1===(null!==(i=t("isShopperTrackingEnabled"))&&0[0]!==i?i:n("is_shopper_tracking_enabled")))return;const l=null!==(a=t("platformTrackerNonce"))&&0[0]!==a?a:null===(r=n("nonce"))||0[0]===r?0[0]:r.platform_tracker,d=null!==(c=t("ajaxUrl"))&&0[0]!==c?c:n("ajax_url"),o=new FormData;o.append("tracksNonce",l),o.append("action","platform_tracks"),o.append("tracksEventName",e),o.append("tracksEventProp",JSON.stringify(s)),fetch(d,{method:"post",body:o}).then(e=>e.json())})("wcpay_proceed_to_checkout_button_click",{woopay_direct_checkout:Boolean(t("isWooPayDirectCheckoutEnabled"))&&!j()})};window.addEventListener("load",()=>{Object.values(l.redirectElements).forEach(e=>{const t=document.querySelector(e);t&&t.addEventListener("click",c)}),(()=>{const e=document.querySelector(".cart-collaterals");e&&new MutationObserver(()=>{const e=document.querySelector(l.redirectElements.CLASSIC_CART_PROCEED_BUTTON);e&&e.addEventListener("click",c)}).observe(e,{childList:!0,subtree:!0})})()})})()})()