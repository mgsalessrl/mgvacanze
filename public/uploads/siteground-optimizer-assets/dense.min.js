(function(e){"use strict";typeof define=="function"&&define.amd?define(["jquery"],e):e(window.jQuery||window.Zepto)})(function(e){"use strict";var n,s=[],t={},o=/^([a-z]:)?\/\//i,i=/\.\w+$/;t.init=function(a){return a=e.extend({ping:null,dimensions:"preserve",glue:"_",skipExtensions:["svg"]},a),this.each(function(){if(r=e(this),!r.is("img")||r.hasClass("dense-image"))return;r.addClass("dense-image dense-loading");var r,d,c=t.getImageAttribute.call(this),l=r.attr("src"),u=!1;if(!c){if(!l||n===1||e.inArray(l.split(".").pop().split(/[?#]/).shift(),a.skipExtensions)!==-1){r.removeClass("dense-image dense-loading");return}c=l.replace(i,function(e){return a.glue+n+"x"+e}),u=a.ping!==!1&&e.inArray(c,s)===-1&&(a.ping===!0||!o.test(c)||c.indexOf("//"+document.domain)===0||c.indexOf(document.location.protocol+"//"+document.domain)===0)}d=function(){var e=function(){r.removeClass("dense-loading").addClass("dense-ready").trigger("denseRetinaReady.dense")};r.attr("src",c),a.dimensions==="update"?r.dense("updateDimensions").one("denseDimensionChanged",e):(a.dimensions==="remove"&&r.removeAttr("width height"),e())},u?e.ajax({url:c,type:"HEAD"}).done(function(e,t,n){var o=n.getResponseHeader("Content-type");(!o||o.indexOf("image/")===0)&&(s.push(c),d())}):d()}),this},t.updateDimensions=function(){return this.each(function(){var t,n=e(this),s=n.attr("src");s&&(t=new Image,t.src=s,e(t).on("load.dense",function(){n.attr({width:t.width,height:t.height}).trigger("denseDimensionChanged.dense")}))})},t.devicePixelRatio=function(){var t=1;return e.type(window.devicePixelRatio)!=="undefined"?t=window.devicePixelRatio:e.type(window.matchMedia)!=="undefined"&&e.each([1.3,2,3,4,5,6],function(e,n){var s=["(-webkit-min-device-pixel-ratio: "+n+")","(min-resolution: "+Math.floor(n*96)+"dpi)","(min-resolution: "+n+"dppx)"].join(",");if(!window.matchMedia(s).matches)return!1;t=n}),Math.ceil(t)},t.getImageAttribute=function(){for(var t,i=e(this).eq(0),o=!1,s=1;s<=n;s++)t=i.attr("data-"+s+"x"),t&&(o=t);return o},n=t.devicePixelRatio(),e.fn.dense=function(n,s){return(e.type(n)!=="string"||e.type(t[n])!=="function")&&(s=n,n="init"),t[n].call(this,s)},e(function(){e("body.dense-retina img").dense()})})