jQuery(document).ready(function(e){"use strict";wpestate_create_delete_invoice_action(),wpestate_create_generate_invoice_action(),wprentals_show_static_calendar_backend(),wpestate_show_bedrooms_input_trigger(),wpestate_limit_bathrooms_input(),wpestate_reply_to_review(),jQuery(".user_dashboard_panel_guide a,.edit_listing_link").on("click",function(t){if(wpestate_check_for_mandatory())t.preventDefault();else{var n=e(this).attr("href");jQuery(".next_submit_page").attr("href",n),jQuery(".wpestate_vc_button").trigger("click");return}}),jQuery(".next_submit_page").on("click",function(e){e.preventDefault(),jQuery(".wpestate_vc_button").trigger("click")}),jQuery(".delete_extra_detail").on("click",function(){e(this).parent().parent().remove()}),jQuery("#add_extra_detail").on("click",function(){var o,n=e("#custom_detail_value").val(),s=e("#custom_detail_label").val();n!==""&&s!=""&&(o='<div class="extra_detail_option_wrapper"><div class="extra_detail_option  col-md-4"><input type="text" class=" extra_option_name form-control" value="'+s+`"></div>
<div class="extra_detail_option  col-md-4"><input type="text"class=" extra_option_value form-control" value="`+n+`">
</div></div>`,e("#custom_detail_value").val(""),e("#custom_detail_label").val(""),e("#extra_details_list").append(o))}),jQuery("#add_extra_feed").on("click",function(){var n,o=e("#property_icalendar_import_name_new").val(),s=e("#property_icalendar_import_feed_new").val();s!==""&&(n='<div class="icalfeed"><input type="text" class="form-control property_icalendar_import_name_new" size="40" width="200"  name="property_icalendar_import_name[]" value="'+o+'"><input type="text"  class="form-control property_icalendar_import_feed_new" size="40" width="200" name="property_icalendar_import_feed[]" value="'+s+'"></div>',e("#property_icalendar_import_name_new").val(""),e("#property_icalendar_import_feed_new").val(""),e("#icalfeed_wrapper").append(n))}),jQuery(".delete_extra_option").on("click",function(){jQuery(this).parent().remove()}),jQuery("#add_extra_option").on("click",function(){var s,o,i,a,r;e(".no_extra_pay_option").remove(),s=e("#add_option_name").val(),o=e("#add_option_value").val(),i=e("#add_option_type").val(),r=s+"_select",a='<div class="extra_pay_option"><input type="text" class="add_option_input extra_option_name form-control" value="'+s+`">
<input type="text"  class="add_option_input extra_option_value form-control" value="`+o+`">
`+n(i)+"</div>",e("#add_option_name").val(""),e("#add_option_value").val(""),e(".extra_pay_option_wrapper").append(a)});function n(e){var t="",n="",s="",o="";return e=parseInt(e),e===0?t=" selected ":e===1?n=" selected ":e===2?s=" selected ":e===3&&(o=" selected "),'<select class="select_submit_price"><option value="0" '+t+">"+dashboard_vars.single_fee+'</option><option value="1" '+n+" >"+dashboard_vars.per_hdnight+'</option><option value="2" '+s+">"+dashboard_vars.per_guest+'</option><option value="3" '+o+">Per H/Day/Night per Guest</option></select>"}jQuery(".activate_payments").on("click",function(){jQuery(this).parent().parent().find(".listing_submit").show()}),jQuery(".close_payments").on("click",function(){jQuery(this).parent().hide()}),jQuery("#invoice_start_date").datepicker({},jQuery.datepicker.regional[control_vars.datepick_lang]).datepicker("widget").wrap('<div class="ll-skin-melon"/>'),jQuery("#invoice_end_date").datepicker({},jQuery.datepicker.regional[control_vars.datepick_lang]).datepicker("widget").wrap('<div class="ll-skin-melon"/>'),e("#invoice_start_date, #invoice_end_date, #invoice_type ,#invoice_status ").change(function(){filter_invoices()}),e(".mess_send_reply_button").on("click",function(){var o=control_vars.admin_url+"admin-ajax.php",t=e(this).parent().parent(),c=t.find(".mess_content"),r=e(this).parent(),s=t.attr("data-messid"),n=e(this),i=t.find(".subject_reply").val(),a=t.find(".message_reply_content").val(),l=e(this).attr("data-mess-reply_to_id"),d=jQuery("#wprentals_inbox_actions").val();t.find(".mess_unread").remove(),n.text(dashboard_vars.sending),jQuery.ajax({type:"POST",url:o,data:{action:"wpestate_message_reply",messid:s,title:i,content:a,reply_to_id:l,security:d},success:function(){e(".message_reply_content").val(""),n.text(dashboard_vars.send_reply),c.hide(),r.hide()},error:function(){}})}),e(".message_header").on("click",function(){var i=control_vars.admin_url+"admin-ajax.php",n=e(this).parent(),o=n.attr("data-messid"),r=e(this),s=n.find(".mess_reply_form").attr("data-unread_replies"),s=parseInt(s,10),a=jQuery("#wprentals_inbox_actions").val();e(".mess_content, .mess_reply_form").hide(),e(this).parent().find(".mess_content, .mess_reply_form").show(),jQuery.ajax({type:"POST",url:i,data:{action:"wpestate_booking_mark_as_read",messid:o,replies_to_mark:s,security:a},success:function(){n.find(".mess_unread").length>0&&(n.find(".mess_unread").remove(),t(s))},error:function(){}})}),e(".mess_reply").on("click",function(n){return;n.stopPropagation(),a=control_vars.admin_url+"admin-ajax.php",s=e(this).parent().parent().parent(),i=s.attr("data-messid"),r=e(this),e(".mess_content, .mess_reply_form").hide(),s.find(".mess_content").show(),s.find(".mess_reply_form").show();var s,i,a,r,o=s.find(".mess_reply_form").attr("data-unread_replies"),o=parseInt(o,10),c=jQuery("#wprentals_inbox_actions").val();jQuery.ajax({type:"POST",url:a,data:{action:"wpestate_booking_mark_as_read",messid:i,replies_to_mark:o,security:c},success:function(){s.find(".mess_unread").length>0&&(s.find(".mess_unread").remove(),t(o))},error:function(){}})}),e(".mess_delete").on("click",function(n){if(confirm(dashboard_vars.delete_mess)){n.stopPropagation(),i=control_vars.admin_url+"admin-ajax.php",s=e(this).parent().parent().parent().parent(),o=s.attr("data-messid"),a=e(this),e(this).parent().parent().empty().addClass("delete_inaction").html(dashboard_vars.deleting);var s,o,i,a,r=jQuery("#wprentals_inbox_actions").val();jQuery.ajax({type:"POST",url:i,data:{action:"wpestate_booking_delete_mess",messid:o,security:r},success:function(){s.parent().remove(),e(".mess_content, .mess_reply_form").hide(),s.find(".mess_unread").length>0&&(s.find(".mess_unread").remove(),t(1))},error:function(){}})}});function t(e){var n=parseInt(jQuery(".user_dashboard_links .unread_mess_wrap_menu").text(),10),t=n-e;t<0&&(t=0),jQuery("#unread_mess_wrap_no").text(t),jQuery(".unread_mess_wrap_menu").text(t)}e(".post_review").on("click",function(){var t=e(this).attr("data-listing-review"),i=e(this).attr("data-bookid"),n=control_vars.admin_url+"admin-ajax.php",r=e(this),s=e(this).parent().parent(),a=jQuery("#wprentals_reservation_actions").val();jQuery.ajax({type:"POST",url:n,data:{action:"wpestate_show_review_form",listing_id:t,bookid:i,security:a},success:function(e){jQuery(".create_invoice_form").remove(),s.after(e),o()},error:function(){}})});function s(){jQuery(".empty_star").on("mouseenter",function(){var t,n=jQuery(this).parent().find(".empty_star").index(this);jQuery(this).parent().find(".empty_star").each(function(){t=jQuery(this).parent().find(".empty_star").index(this),t<=n?jQuery(this).addClass("starselected"):jQuery(this).removeClass("starselected")})})}function o(){s(),jQuery("#post_review").on("click",function(){var o,i=jQuery(this).attr("data-listing_id"),a=jQuery(this).attr("data-bookid"),r=jQuery(this).parent().find("#review_content").val(),n=jQuery(this).parent().find(".starselected").parent(),c=control_vars.admin_url+"admin-ajax.php",l=jQuery(this),s=jQuery(this).parent().parent(),t=0,e="{";n.each(function(){var s=parseInt(jQuery(this).find(".starselected").length);t=t+s,e+='"'+jQuery(this).attr("class")+'": '+s+","}),e+='"rating": '+(Math.round(t/n.length*2)/2).toFixed(1),e+="}",jQuery(this).text(dashboard_vars.sending),o=jQuery("#wprentals_reservation_actions").val(),jQuery.ajax({type:"POST",url:c,data:{action:"wpestate_post_review",listing_id:i,bookid:a,stars:e,content:r,security:o},success:function(e){jQuery(".create_invoice_form").remove(),jQuery(".post_review").remove(),s.after('<div class="row dashboard_property_list user_dashboard_panel"><p class="post-review-message success">'+e.data.message+"</p></div>")},error:function(e){s.after('<div class="row dashboard_property_list user_dashboard_panel"><p class="post-review-message error">'+e.data.message+"</p></div>")}})})}e(".full_invoice_reminder").on("click",function(){n=e(this).attr("data-bookid"),t=e(this).attr("data-invoiceid"),s=control_vars.admin_url+"admin-ajax.php",o=e(this),i=e(this).parent().parent(),e(this).text(dashboard_vars.sending),e(this).unbind("click");var t,n,s,i,o=e(this),a=jQuery("#wprentals_bookings_actions").val();jQuery.ajax({type:"POST",url:s,data:{action:"wpestate_send_full_pay_reminder",invoice_id:t,booking_id:n,security:a},success:function(){o.text(dashboard_vars.sent)},error:function(){}})}),e(".trip_details").on("click",function(){s=e(this).attr("data-booking-confirmed"),n=e(this).attr("data-invoice-confirmed"),o=control_vars.admin_url+"admin-ajax.php",t=e(this),t.text(dashboard_vars.processing);var t,n,s,o,i=e(this).parent().parent(),a=jQuery("#wprentals_booking_confirmed_actions").val();jQuery.ajax({type:"POST",url:o,data:{action:"wpestate_show_trip_details",invoice_id:n,booking_id:s,security:a},success:function(e){jQuery(".trip_details_wrapper,.create_invoice_form").remove(),i.after(e),create_trip_print_action(),t.text(dashboard_vars.trip_details)},error:function(){}})}),e(".confirmed_booking").on("click",function(){s=e(this).attr("data-booking-confirmed"),n=e(this).attr("data-invoice-confirmed"),o=control_vars.admin_url+"admin-ajax.php",t=e(this),t.text(dashboard_vars.processing);var t,n,s,o,i=e(this).parent().parent(),a=jQuery("#wprentals_booking_confirmed_actions").val();jQuery.ajax({type:"POST",url:o,data:{action:"wpestate_show_confirmed_booking",invoice_id:n,booking_id:s,security:a},success:function(e){jQuery(".trip_details_wrapper,.create_invoice_form").remove(),i.after(e),wpestate_create_payment_action(),create_print_action(),t.text(dashboard_vars.view_details)},error:function(){}})}),wpestate_enable_invoice_actions(),e(".proceed-payment,.proceed-payment_full").on("click",function(){s=e(this).attr("data-invoiceid"),o=e(this).attr("data-bookid"),i=control_vars.admin_url+"admin-ajax.php",n=e(this),n.text(dashboard_vars.processing),a=e(this).parent().parent(),t=0,e(this).hasClass("proceed-payment_full")&&(t=1);var t,n,s,o,i,a,r=jQuery("#wprentals_reservation_actions").val();jQuery.ajax({type:"POST",url:i,data:{action:"wpestate_create_pay_user_invoice_form",booking_id:o,invoice_id:s,is_full:t,security:r},success:function(e){jQuery(".create_invoice_form").remove(),a.after(e),wpestate_create_payment_action(),create_print_action(),t===1?n.text(dashboard_vars.invoice_pay):n.text(dashboard_vars.invoice_created)},error:function(){}})}),e(".delete_booking").on("click",function(){if(confirm(dashboard_vars.cancel_mess)){n=e(this).attr("data-bookid"),s=control_vars.admin_url+"admin-ajax.php",o=e(this),t=0,e(this).hasClass("usercancel")&&(t=1),e(this).empty().html(dashboard_vars.deleting),e(".create_invoice_form").remove();var t,n,s,o,i=jQuery("#wprentals_booking_confirmed_actions").val();e.ajax({type:"POST",url:s,data:{action:"wpestate_delete_booking_request",booking_id:n,isuser:t,security:i},success:function(){o.parent().parent().remove()},error:function(){}})}}),e(".cancel_own_booking, .cancel_user_booking").on("click",function(){if(confirm(dashboard_vars.cancel_mess)){t=e(this).attr("data-booking-confirmed"),o=e(this).attr("data-listing-id"),n=control_vars.admin_url+"admin-ajax.php",s=e(this),e(this).empty().html(dashboard_vars.deleting),e(".create_invoice_form").hide();var t,n,s,o,i=jQuery("#wprentals_booking_confirmed_actions").val();e.ajax({type:"POST",url:n,data:{action:"wpestate_cancel_own_booking",booking_id:t,listing_id:o,security:i},success:function(){s.parent().parent().remove()},error:function(){}})}})});function wpestate_chart_total_listings_widget(e,t,n){if(!document.getElementById("myChart_widget_total"))return;var s=jQuery("#myChart_widget_total").get(0).getContext("2d"),r=new Chart(s),o="  ",o=e,i={labels:t,datasets:[{label:n,fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:o}]},a={title:"page views",scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},c=new Chart(s,{type:"line",data:i,options:a})}function wpestate_create_generate_invoice_action(){jQuery(".generate_invoice").on("click",function(){n=control_vars.admin_url+"admin-ajax.php",t=jQuery(this).parent().parent(),s=jQuery(this).attr("data-bookid"),e=jQuery(this),e.text(dashboard_vars.processing);var e,t,n,s,o=jQuery("#wprentals_bookings_actions").val();jQuery.ajax({type:"POST",url:n,data:{action:"wpestate_create_invoice_form",bookid:s,security:o},success:function(n){jQuery(".create_invoice_form").remove(),t.after(n),wpestate_invoice_create_js(),e.text(dashboard_vars.invoice_issue)},error:function(){}})})}function wpestate_create_delete_invoice_action(){"use strict";jQuery(".delete_invoice").on("click",function(){if(confirm(dashboard_vars.delete_mess)){s=jQuery(this).attr("data-bookid"),t=jQuery(this).attr("data-invoiceid"),n=control_vars.admin_url+"admin-ajax.php",e=jQuery(this),jQuery(this).empty().html("deleting...");var e,t,n,s,o=jQuery("#wprentals_bookings_actions").val();jQuery.ajax({type:"POST",url:n,data:{action:"wpestate_delete_invoice",invoice_id:t,booking_id:s,security:o},success:function(){var n=e.parent().find(".delete_booking").attr("data-bookid");e.parent().find(".waiting_payment").after('<span class="generate_invoice" data-bookid="'+n+'">'+dashboard_vars.issue_inv1+"</span>"),e.parent().find(".waiting_payment").remove(),e.remove(),wpestate_create_generate_invoice_action()},error:function(){}})}})}function wpestate_calculate_deposit_js(e,t,n){var s;return t===0?(s=n*e/100,s=Math.round(s*100)/100):s=t,s}function wpestate_invoice_create_js(){"use strict";jQuery("#add_inv_expenses,#add_inv_discount").on("click",function(){var t=jQuery(this);e(t)});function t(){"use strict";jQuery(".delete_exp").unbind("click"),jQuery(".delete_exp").on("click",function(){var n=jQuery(this);e(n)})}function e(e){if(j=0,h=jQuery("#inv_expense_name").val(),s=parseFloat(jQuery("#inv_expense_value").val()),e.is("#add_inv_discount")&&(h=dashboard_vars.discount,s=parseFloat(jQuery("#inv_expense_discount").val(),10)*-1),e.hasClass("delete_exp")&&(j=1,h="nothng",s=parseFloat(e.attr("data-delvalue"))*-1),O=e.attr("data-include_ex"),dashboard_vars.where_currency_symbol==="before"?y=dashboard_vars.currency_symbol+' <span class="inv_data_value" data-clearprice="'+s+'">'+s+"</span>":y='<span class="inv_data_value"  data-clearprice="'+s+'" >'+s+"</span> "+dashboard_vars.currency_symbol,i=parseFloat(jQuery("#total_amm").attr("data-total")),d=parseFloat(jQuery("#cleaning-fee").attr("data-cleaning-fee")),l=parseFloat(jQuery("#city-fee").attr("data-city-fee")),n=parseFloat(jQuery("#erarly_bird_row").attr("data-val")),A=parseFloat(jQuery("#inv_depozit").attr("data-val")),k=parseFloat(jQuery("#inv_balance").attr("data-val")),o=parseFloat(jQuery("#youearned").attr("data-youearned")),c=parseFloat(jQuery("#inv_service_fee").attr("data-value")),a=parseFloat(jQuery("#inv_taxes").attr("data-value")),f=parseFloat(jQuery("#inter_price").attr("data-value")),u=parseFloat(jQuery("#security_depozit_row").attr("data-val")),C=parseFloat(jQuery("#property_details_invoice").attr("data-earlyb")),E=parseFloat(jQuery("#property_details_invoice").attr("data-taxes_value")),b=parseFloat(jQuery("#extra-guests").attr("data-extra-guests")),p=0,jQuery(".invoice_default_extra").each(function(){p=p+parseFloat(jQuery(this).attr("data-value"))}),v=s,jQuery(".invoice_manual_extra").each(function(){v=v+parseFloat(jQuery(this).attr("data-value"))}),isNaN(d)&&(d=0),isNaN(l)&&(l=0),isNaN(b)&&(b=0),isNaN(n)&&(n=0),isNaN(a)&&(a=0),isNaN(m)&&(m=0),isNaN(o)&&(o=0),isNaN(f)&&(f=0),isNaN(u)&&(u=0),h!==""&&s!==""&&h!==0&&s!==0&&!isNaN(s)){j==1?e.parent().remove():(x='<div class="invoice_row invoice_content manual_ex"><span class="inv_legend">'+h+'</span><span class="inv_data invoice_manual_extra" data-value="'+s+'">'+y+'</span><span class="inv_exp"></span><span class="delete_exp" data-include_ex="'+O+'" data-delvalue="'+s+'"><i class="fas fa-times"></i></span></div>',jQuery(".invoice_total").before(x),jQuery("#inv_expense_name").val(""),jQuery("#inv_expense_value").val(""),jQuery("#inv_expense_discount").val("")),n>0&&(n=(f+p+v+b)*C/100);var n,s,o,i,a,r,c,l,d,u,h,m,f,p,g,v,b,j,y,_,w,O,x,C,E,k,A,M,S=parseFloat(dashboard_vars.service_fee);m=parseFloat(dashboard_vars.service_fee_fixed_fee),i=f+p+v+b-n+l+d+u,parseFloat(m,10)>0?c=parseFloat(m):c=(i-u-l-d)*S/100,o=i-u-l-d-c,o=Math.round(o*100)/100,a=o*E/100,a=Math.round(a*100)/100,w=parseFloat(dashboard_vars.book_down),_=parseFloat(dashboard_vars.book_down_fixed_fee),O==="yes"?r=wpestate_calculate_deposit_js(w,_,i):r=wpestate_calculate_deposit_js(w,_,i-l-d),r=Math.round(r*100)/100,g=i-r,g=Math.round(g*100)/100,t(),jQuery("#total_amm").attr("data-total",i),dashboard_vars.where_currency_symbol==="before"?(jQuery("#inv_depozit").empty().html(dashboard_vars.currency_symbol+" "+r),jQuery("#inv_depozit").attr("data-value",r),jQuery("#inv_balance").empty().html(dashboard_vars.currency_symbol+" "+g),jQuery("#total_amm").empty().append(dashboard_vars.currency_symbol+" "+i),jQuery("#youearned").attr("data-value",o),jQuery("#youearned").empty().html(dashboard_vars.currency_symbol+" "+o),jQuery("#inv_service_fee").attr("data-value",c),jQuery("#inv_service_fee").empty().html(dashboard_vars.currency_symbol+" "+c),jQuery("#inv_taxes").attr("data-value",a),jQuery("#inv_taxes").empty().html(dashboard_vars.currency_symbol+" "+a),jQuery("#erarly_bird_row").attr("data-value",n),jQuery("#erarly_bird_row inv_data_value").attr("data-clearprice",n),jQuery("#erarly_bird_row").empty().html(dashboard_vars.currency_symbol+'<span class="inv_data_value" data-clearprice="'+n+'"> '+n+"</span> ")):(jQuery("#inv_depozit").empty().html(r+" "+dashboard_vars.currency_symbol),jQuery("#inv_depozit").attr("data-value",r),jQuery("#inv_balance").empty().html(g+" "+dashboard_vars.currency_symbol),jQuery("#total_amm").empty().append(i+" "+dashboard_vars.currency_symbol),jQuery("#youearned").attr("data-value",o),jQuery("#youearned").empty().html(o+" "+dashboard_vars.currency_symbol),jQuery("#inv_service_fee").attr("data-value",c),jQuery("#inv_service_fee").empty().html(c+" "+dashboard_vars.currency_symbol),jQuery("#inv_taxes").attr("data-value",a),jQuery("#inv_taxes").empty().html(a+" "+dashboard_vars.currency_symbol),jQuery("#erarly_bird_row").attr("data-value",n),jQuery("#erarly_bird_row inv_data_value").attr("data-clearprice",n),jQuery("#erarly_bird_row").empty().html('<span class="inv_data_value" data-clearprice="'+n+'"> '+n+"</span> "+dashboard_vars.currency_symbol))}}jQuery("#invoice_submit").on("click",function(){var e,n,o,m,r=new Array,c=new Array,l=control_vars.admin_url+"admin-ajax.php",i=jQuery(this).attr("data-bookid"),s=jQuery(this).attr("data-is_confirmed"),a=parseFloat(jQuery("#total_amm").attr("data-total")),h=parseFloat(jQuery("#youearned").attr("data-youearned")),t=jQuery(this).parent().parent().prev(),d=jQuery(this),u=parseFloat(jQuery("#inv_depozit").attr("data-value"));jQuery(this).text(control_vars.pls_wait),jQuery(".invoice_content").each(function(){e=new Array,e[0]=jQuery(this).find(".inv_legend").text(),e[1]=jQuery(this).find(".inv_data_value").attr("data-clearprice"),e[2]=jQuery(this).find(".inv_data_exp").text(),r.push(e)}),jQuery(".manual_ex").each(function(){n=new Array,n[0]=jQuery(this).find(".inv_legend").text(),n[1]=jQuery(this).find(".inv_data_value").attr("data-clearprice"),n[2]=jQuery(this).find(".inv_data_exp").text(),c.push(n)}),o=jQuery("#security-create_invoice_ajax_nonce").val(),jQuery.ajax({type:"POST",url:l,data:{action:"wpestate_add_booking_invoice",bookid:i,price:a,details:r,manual_expenses:c,to_be_paid:u,youearned:h,is_confirmed:s,security:o},success:function(e){e==="stop"?(jQuery(".alert_error").remove(),d.before('<span class="alert_error"> '+dashboard_vars.doublebook+"</span>")):(t.find(".invoice_list_id").html(e),s!==1&&s!=="1"&&t.find(".generate_invoice").after('<span class="delete_invoice" data-invoiceid="'+e+'" data-bookid="'+i+'">'+dashboard_vars.delete_inv+"</span>"),t.find(".generate_invoice").after('<span class="waiting_payment">'+dashboard_vars.issue_inv+"</span>"),t.find(".generate_invoice").remove(),t.find("#inv_new_price").empty().append(a),jQuery(".create_invoice_form").remove(),wpestate_create_delete_invoice_action())},error:function(){}})}),jQuery("#direct_confirmation").on("click",function(){var e,n=new Array,i=control_vars.admin_url+"admin-ajax.php",a=jQuery(this).attr("data-bookid"),r=jQuery("#total_amm").attr("data-total"),t=jQuery(this).parent().parent().prev(),s=jQuery(this),o=jQuery("#security-create_invoice_ajax_nonce").val();jQuery(".invoice_content").each(function(){e=new Array,e[0]=jQuery(this).find(".inv_legend").text(),e[1]=jQuery(this).find(".inv_data_value").attr("data-clearprice"),e[2]=jQuery(this).find(".inv_data_exp").text(),n.push(e)}),jQuery.ajax({type:"POST",url:i,data:{action:"wpestate_add_booking_invoice",bookid:a,price:r,details:n,security:o},success:function(e){e==="doublebook"?(s.after('<div class="delete_booking" style="float:left;">'+dashboard_vars.doublebook+"</div>"),s.remove()):(t.find(".generate_invoice").after('<span class="tag-published">'+dashboard_vars.confirmed+"</span>"),t.find(".generate_invoice").remove(),t.find(".delete_booking").remove(),jQuery(".create_invoice_form").remove())},error:function(){}})})}function wpestate_create_payment_action(){"use strict";jQuery("#confirm_zero_instant_booking").on("click",function(){e=control_vars.admin_url+"admin-ajax.php",s=jQuery(this).attr("data-propid"),t=jQuery(this).attr("data-bookid"),n=jQuery(this).attr("data-invoiceid"),o=jQuery(this).attr("data-deposit"),jQuery(this).text(control_vars.pls_wait);var e,t,n,s,o,a,r,c,i=jQuery("#wprentals_confirm_zero_instant_booking").val();jQuery.ajax({type:"POST",url:e,data:{action:"wpestate_admin_activate_reservation_fee",book_id:t,invoice_id:n,security:i,is_zero_instant:1},success:function(){window.open(control_vars.my_reservations_url,"_self",!1)},error:function(){}})}),jQuery("#paypal_booking").on("click",function(){var t=jQuery(this).attr("data-propid"),n=jQuery(this).attr("data-bookid"),s=jQuery(this).attr("data-invoiceid"),o=jQuery(this).attr("data-deposit"),i=0,a=0,e='<div class="modal fade" id="paypal_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-body listing-submit">'+ajaxcalls_vars.paypal+"</div></div></div></div></div>";jQuery("body").append(e),jQuery("#paypal_modal").modal(),wpestate_booking_cretupm_paypal(t,n,s,o)}),jQuery("#direct_pay_booking").on("click",function(){var s,e=jQuery(this).attr("data-propid"),t=jQuery(this).attr("data-bookid"),n=jQuery(this).attr("data-invoiceid"),o=0,i=0;wpestate_enable_booking_direct_pay(e,t,n)}),jQuery(".woo_pay").on("click",function(){var e,a,n=jQuery(this).attr("data-propid"),s=jQuery(this).attr("data-bookid"),o=jQuery(this).attr("data-invoiceid"),i=jQuery(this).attr("data-deposit"),r=0,c=0,t=0;jQuery(this).hasClass("woo_pay_submit")&&(t=1),e=ajaxcalls_vars.admin_url+"admin-ajax.php",jQuery.ajax({type:"POST",url:e,data:{action:"wpestate_woo_pay",invoiceid:o,propid:n,book_id:s,depozit:i,is_submit:t},success:function(e){e!==!1&&(window.location.href=dashboard_vars.checkout_url)},error:function(){}})}),jQuery("#wpestate_stripe_booking").on("click",function(){var e=jQuery(this).attr("data-modalid");jQuery("#"+e).show(),jQuery("#"+e+" .wpestate_stripe_form_1").show(),wpestate_start_stripe(0,e)}),jQuery(".close_stripe_form").on("click",function(){jQuery(".wpestate_stripe_form_wrapper").hide(),jQuery(".wpestate_stripe_form_1").hide()})}function wpestate_enable_booking_direct_pay(e,t,n){jQuery("#is_full_pay").length==0?s=parseFloat(jQuery(".depozit_show").attr("data-value"),10):s=parseFloat(jQuery("#is_full_pay").val());var s,o,i,r,c,l,d,a=s;control_vars.where_curency==="after"?s=s+" "+control_vars.submission_curency:s=control_vars.submission_curency+" "+s,s=control_vars.direct_price+": "+s,i!==""&&(window.scrollTo(0,0),o='<div class="modal fade" id="direct_pay_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button><h2 class="modal-title_big">'+control_vars.direct_title+'</h2></div><div class="modal-body listing-submit"><span class="to_be_paid">'+s+"</span><span>"+control_vars.direct_pay+'</span><div id="send_direct_bill_booking" data-invoiceid="'+n+'"  data-propid="'+e+'" data-bookid="'+t+'">'+control_vars.send_invoice+"</div></div></div></div></div></div>",jQuery("body").append(o),jQuery("#direct_pay_modal").modal(),wpestate_enable_booking_direct_pay_button(a)),jQuery("#direct_pay_modal").on("hidden.bs.modal",function(){jQuery("#direct_pay_modal").remove()})}function wpestate_enable_booking_direct_pay_button(e){jQuery("#send_direct_bill_booking").unbind("click"),jQuery("#send_direct_bill_booking").on("click",function(){t=jQuery(this),t.text(dashboard_vars.processing),jQuery("#send_direct_bill_booking").unbind("click");var n,s=jQuery(this).attr("data-invoiceid"),i=jQuery(this).attr("data-propid"),a=jQuery(this).attr("data-bookid"),o=ajaxcalls_vars.admin_url+"admin-ajax.php",t=jQuery(this);t.text(dashboard_vars.processing),n=jQuery("#wprentals_reservation_actions").val(),jQuery.ajax({type:"POST",url:o,data:{action:"wpestate_direct_pay_booking",invoiceid:s,propid:i,book_id:a,price_pack:e,security:n},success:function(){jQuery("#send_direct_bill_booking").hide(),jQuery("#direct_pay_modal .listing-submit span:nth-child(2)").empty().html(control_vars.direct_thx)},error:function(){}})})}function wpestate_booking_cretupm_paypal(e,t,n,s){"use strict";var o=control_vars.admin_url+"admin-ajax.php",i=jQuery("#wprentals_reservation_actions").val();jQuery.ajax({type:"POST",url:o,data:{action:"wpestate_ajax_booking_pay",propid:e,bookid:t,invoice_id:n,depozit:s,security:i},success:function(e){window.location.href=e},error:function(){}})}function filter_invoices(){"use strict";e=jQuery("#invoice_start_date").val(),e!==""&&(e=wpestate_convert_selected_days(e)),t=jQuery("#invoice_end_date").val(),t!==""&&(t=wpestate_convert_selected_days(t));var e,t,s=jQuery("#invoice_type").val(),o=jQuery("#invoice_status").val(),i=jQuery("#wprentals_invoice_pace_actions").val(),n=control_vars.admin_url+"admin-ajax.php";jQuery.ajax({type:"POST",url:n,dataType:"json",data:{action:"wpestate_ajax_filter_invoices",start_date:e,end_date:t,type:s,status:o,security:i},success:function(e){jQuery("#container-invoices").empty().append(e.results),jQuery("#invoice_issued").empty().append(e.invoice_issued),jQuery("#invoice_confirmed").empty().append(e.invoice_confirmed),wpestate_enable_invoice_actions()},error:function(){}})}function wpestate_enable_invoice_actions(){jQuery(".invoice_unit").on("click",function(){t=jQuery(this).attr("data-booking-confirmed"),e=jQuery(this).attr("data-invoice-confirmed"),n=control_vars.admin_url+"admin-ajax.php",s=jQuery(this),s.find(".invoice_unit_title_wrapper").append('<div class="wprentals_invoce_processing">'+dashboard_vars.processing+"</div>");var e,t,n,s,o=jQuery(this),i=jQuery("#wprentals_invoice_pace_actions").val();jQuery.ajax({type:"POST",url:n,data:{action:"wpestate_show_invoice_dashboard",invoice_id:e,booking_id:t,security:i},success:function(e){jQuery(".create_invoice_form").remove(),o.append(e),wpestate_create_payment_action(),create_print_action(),jQuery(".wprentals_invoce_processing").remove()},error:function(){}})})}function create_trip_print_action(){jQuery("#print_trip").on("click",function(e){n=control_vars.admin_url+"admin-ajax.php",e.preventDefault();var n,s=jQuery(this).attr("data-property"),o=jQuery(this).attr("data-booking"),i=jQuery("#wprentals_print_invoice").val(),t=window.open("","Print Me","width=700 ,height=842");jQuery.ajax({type:"POST",url:n,data:{action:"wprentals_ajax_create_print_trip",property_id:s,booking_id:o,security:i},success:function(e){t.document.write(e),t.document.close(),t.focus()},error:function(){}})})}function create_print_action(){jQuery("#print_invoice").on("click",function(e){n=control_vars.admin_url+"admin-ajax.php",e.preventDefault();var n,s=jQuery(this).attr("data-invoice_id"),o=jQuery("#wprentals_print_invoice").val(),t=window.open("","Print Me","width=700 ,height=842");jQuery.ajax({type:"POST",url:n,data:{action:"ajax_create_print",invoice_id:s,security:o},success:function(e){t.document.write(e),t.document.close(),t.focus()},error:function(){}})})}function wprentals_show_static_calendar_backend(){if(typeof dashboard_vars2=="undefined"||typeof fullCalendar=="undefined")return;if(jQuery("#all-front-calendars_per_hour_internal").length>0){var e,n,o=new Date,i="",s=[],t=[];dashboard_vars2.booking_array!==""&&dashboard_vars2.booking_array.length!==0&&(t=JSON.parse(dashboard_vars2.booking_array));for(n in t)t.hasOwnProperty(n)&&n!==""&&(e=[],e.title=dashboard_vars.reserved,e.start=moment.unix(n).utc().format(),e.end=moment.unix(t[n]).utc().format(),e.editable=!1,s.push(e));jQuery("#all-front-calendars_per_hour_internal").fullCalendar({defaultView:"agendaWeek",navLinks:!1,defaultDate:o,selectable:!1,selectHelper:!0,selectOverlap:!1,footer:!1,slotDuration:"01:00:00",allDayText:"hours",weekNumbers:!1,weekNumbersWithinDays:!0,weekNumberCalculation:"ISO",editable:!1,eventLimit:!0,unselectAuto:!1,isRTL:control_vars_property.rtl_book_hours_calendar,header:{left:"prev,next today",center:"title",right:""},minTime:control_vars_property.booking_start_hour,maxTime:control_vars_property.booking_end_hour,events:s})}}function wpestate_show_bedrooms_input_trigger(){var e=[];jQuery("#property_bedrooms").on("change",function(){var n,s,t=parseInt(jQuery(this).val(),10);(isNaN(t)||t<0)&&(t=0),n=parseInt(dashboard_vars.max_bedrooms,10),t>n&&(t=n,jQuery(this).val(n),typeof dashboard_vars.max_bedrooms_message!="undefined"&&alert(dashboard_vars.max_bedrooms_message)),s=jQuery("#beds_options_string").val(),wpestate_show_bedrooms_input(t,s)})}function wpestate_limit_bathrooms_input(){jQuery("#property_bathrooms").on("change",function(){var t,e=parseFloat(jQuery(this).val(),10);(isNaN(e)||e<0)&&(e=0),t=parseFloat(dashboard_vars.max_bathrooms,10),e>t&&(e=t,jQuery(this).val(t),typeof dashboard_vars.max_bathrooms_message!="undefined"&&alert(dashboard_vars.max_bathrooms_message))})}function wpestate_show_bedrooms_input(e,t){jQuery("#whole_beds_wrapper").remove();var n,s,o,i,a,c,d,l=dashboard_vars.bed_types,r=Object.keys(l).map(function(e){return[l[e]]});for(t=JSON.parse(t),n='<div class="col-md-12" id="whole_beds_wrapper">',s=0,d=0,i=0,c="";s<e;){s>0&&(c=' style="display:none" '),n=n+'<div class="bed_wrapper"><label>'+dashboard_vars.bedroom+" "+(s+1)+'</label><div class="beds_wrapper_control">'+dashboard_vars.openclose+'</div><div class="bedroom_input_val_wrapper" '+c+" >";for(o=0;o<r.length;o++)i=0,a=String(r[o]),typeof t[a]!="undefined"&&typeof t[a][s]!="undefined"&&(i=t[a][s]),i==""&&(i=0),d++,n=n+'<div class="bedroom_input_val"><label>- '+dashboard_vars.bed_types_names[r[o]]+'</label><input type="text" value="'+i+'" class="beds_no form-control beds_index'+o+'" width="20px;"></div>';s++,n=n+"</div></div>"}n=n+"</div>",jQuery("#property_bedrooms_wrappr").after(n),wpestate_toogle_beds()}function wpestate_toogle_beds(){jQuery(".beds_wrapper_control").on("click",function(){var e=jQuery(this).parent();e.find(".bedroom_input_val_wrapper").slideToggle()})}function wpestate_reply_to_review(){jQuery(".mess_send_reply_review_button").on("click",function(){var n=jQuery(this).attr("data-review-reply-to-id"),s=jQuery(this).attr("data-review-reply-to-propertyid"),e=jQuery(this).parent(),o=jQuery(this),t=e.find(".review_reply_content").val(),i=jQuery("#wprentals_reviews_actions").val(),a=control_vars.admin_url+"admin-ajax.php";jQuery(this).text(dashboard_vars.processing),jQuery.ajax({type:"POST",url:a,dataType:"json",data:{action:"wpestate_review_message_reply",commentId:n,propertyid:s,content:t,security:i},success:function(n){e.find(".wpestate_reply_to_review_message").show().text(n.message),n.succes&&(e.find(".review_reply_content").remove(),o.remove(),e.find(".wpestate_reply_to_review_content").show().append(t))},error:function(){}})})}